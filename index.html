<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Newsletter Manager</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',system-ui,-apple-system,sans-serif}
body{background:linear-gradient(135deg,#0f172a,#1e293b);min-height:100vh;padding:20px;color:#f1f5f9}
.container{max-width:900px;margin:0 auto}
.card{
 background:rgba(15,23,42,0.8);
 backdrop-filter:blur(10px);
 border:1px solid rgba(255,255,255,0.1);
 border-radius:20px;
 padding:32px;
 box-shadow:0 20px 40px rgba(0,0,0,0.3);
 margin-bottom:24px;
 transition:transform 0.3s ease;
}
.card:hover{transform:translateY(-5px)}
h2{margin-bottom:24px;color:#f8fafc;font-size:28px;font-weight:600;display:flex;align-items:center;gap:12px}
h2::before{content:'üì∞';font-size:32px}
.input-group{margin-bottom:20px}
label{display:block;margin-bottom:8px;color:#cbd5e1;font-size:14px;font-weight:500;letter-spacing:0.5px}
input{
 width:100%;
 padding:14px 18px;
 border:2px solid #334155;
 border-radius:12px;
 background:rgba(2,6,23,0.7);
 color:#f8fafc;
 font-size:15px;
 transition:all 0.3s ease;
}
input:focus{
 outline:none;
 border-color:#3b82f6;
 box-shadow:0 0 0 3px rgba(59,130,246,0.2);
 background:rgba(2,6,23,0.9);
}
button{
 background:linear-gradient(135deg,#3b82f6,#1d4ed8);
 color:white;
 border:none;
 padding:14px 24px;
 border-radius:12px;
 cursor:pointer;
 margin:8px;
 font-size:15px;
 font-weight:600;
 letter-spacing:0.5px;
 transition:all 0.3s ease;
 display:inline-flex;
 align-items:center;
 gap:8px;
}
button:hover{
 transform:translateY(-2px);
 box-shadow:0 10px 20px rgba(59,130,246,0.3);
 background:linear-gradient(135deg,#2563eb,#1e40af);
}
.btn-danger{
 background:linear-gradient(135deg,#ef4444,#dc2626);
}
.btn-danger:hover{
 background:linear-gradient(135deg,#dc2626,#b91c1c);
 box-shadow:0 10px 20px rgba(220,38,38,0.3);
}
.btn-secondary{
 background:linear-gradient(135deg,#64748b,#475569);
}
.btn-secondary:hover{
 background:linear-gradient(135deg,#475569,#334155);
 box-shadow:0 10px 20px rgba(100,116,139,0.3);
}
.alert{
 padding:16px 20px;
 border-radius:12px;
 margin-bottom:20px;
 display:none;
 font-size:15px;
 font-weight:500;
 animation:slideIn 0.3s ease;
}
@keyframes slideIn{
 from{opacity:0;transform:translateY(-10px)}
 to{opacity:1;transform:translateY(0)}
}
.alert-success{
 background:linear-gradient(135deg,#10b981,#059669);
 color:#ecfdf5;
 border-left:4px solid#34d399;
}
.alert-error{
 background:linear-gradient(135deg,#f87171,#ef4444);
 color:#fef2f2;
 border-left:4px solid#fca5a5;
}
.info-box{
 background:rgba(30,41,59,0.6);
 border:1px solid rgba(255,255,255,0.1);
 border-radius:12px;
 padding:16px;
 font-size:14px;
 color:#94a3b8;
 margin-bottom:16px;
 display:flex;
 align-items:center;
 gap:12px;
}
.info-box::before{content:'‚ÑπÔ∏è';font-size:18px}
.ids-list{
 background:rgba(2,6,23,0.7);
 border-radius:14px;
 padding:20px;
 margin-top:20px;
 max-height:400px;
 overflow-y:auto;
 border:1px solid rgba(255,255,255,0.1);
}
.ids-list::-webkit-scrollbar{width:6px}
.ids-list::-webkit-scrollbar-track{background:rgba(30,41,59,0.3);border-radius:3px}
.ids-list::-webkit-scrollbar-thumb{background:#3b82f6;border-radius:3px}
.ids-list::-webkit-scrollbar-thumb:hover{background:#2563eb}
.id-item{
 padding:16px;
 border-bottom:1px solid rgba(255,255,255,0.1);
 display:flex;
 justify-content:space-between;
 align-items:center;
 transition:all 0.3s ease;
 background:rgba(15,23,42,0.5);
 border-radius:10px;
 margin-bottom:8px;
}
.id-item:hover{
 background:rgba(30,41,59,0.3);
 transform:translateX(5px);
}
.id-item:last-child{border-bottom:none;margin-bottom:0}
.empty-state{
 text-align:center;
 padding:40px 20px;
 color:#64748b;
 display:flex;
 flex-direction:column;
 align-items:center;
 gap:16px;
}
.empty-state::before{content:'üìÑ';font-size:48px;opacity:0.5}
.timer-display{
 background:linear-gradient(135deg,#f59e0b,#d97706);
 color:#fef3c7;
 padding:8px 16px;
 border-radius:20px;
 font-size:13px;
 margin-left:12px;
 font-weight:600;
 letter-spacing:0.5px;
 animation:pulse 2s infinite;
}
@keyframes pulse{
 0%,100%{opacity:1}
 50%{opacity:0.8}
}
button:disabled{
 opacity:0.5;
 cursor:not-allowed;
 transform:none !important;
 box-shadow:none !important;
}
.topbar{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-bottom:20px;
}
.notice{
 background:linear-gradient(135deg,#1e3a8a,#1e40af);
 color:#dbeafe;
 padding:14px 20px;
 border-radius:12px;
 margin-top:12px;
 font-size:14px;
 line-height:1.6;
 display:flex;
 align-items:center;
 gap:12px;
 border-left:4px solid#3b82f6;
}
.notice::before{content:'‚ö°';font-size:20px}
.action-buttons{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
 gap:16px;
 margin:20px 0;
}
.action-card{
 background:rgba(30,41,59,0.4);
 border-radius:14px;
 padding:24px;
 border:1px solid rgba(255,255,255,0.1);
 transition:all 0.3s ease;
}
.action-card:hover{
 border-color:#3b82f6;
 background:rgba(30,41,59,0.6);
}
.action-title{
 font-size:18px;
 font-weight:600;
 color:#f1f5f9;
 margin-bottom:12px;
 display:flex;
 align-items:center;
 gap:10px;
}
.action-title::before{
 content:'';
 display:inline-block;
 width:8px;
 height:8px;
 border-radius:50%;
 background:#3b82f6;
}
.icon-btn{
 background:rgba(255,255,255,0.1);
 border:none;
 width:36px;
 height:36px;
 border-radius:10px;
 cursor:pointer;
 display:flex;
 align-items:center;
 justify-content:center;
 transition:all 0.2s ease;
 color:#cbd5e1;
}
.icon-btn:hover{
 background:rgba(59,130,246,0.2);
 color:#3b82f6;
 transform:scale(1.1);
}
.stats-bar{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-bottom:20px;
 padding:16px;
 background:rgba(15,23,42,0.5);
 border-radius:12px;
 border:1px solid rgba(255,255,255,0.1);
}
.stat-item{
 text-align:center;
}
.stat-value{
 font-size:24px;
 font-weight:700;
 color:#3b82f6;
}
.stat-label{
 font-size:12px;
 color:#94a3b8;
 text-transform:uppercase;
 letter-spacing:1px;
}
</style>
</head>
<body>
<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card login-box">
    <h2>Newsletter Manager</h2>
    <div class="info-box">
        Masukkan kredensial untuk mengelola ID newsletter
    </div>
    <div class="input-group">
        <label>Username</label>
        <input type="text" id="username" placeholder="Masukkan username">
    </div>
    <div class="input-group">
        <label>Password</label>
        <input type="password" id="password" placeholder="Masukkan password">
    </div>
    <div id="loginAlert" class="alert"></div>
    <button onclick="login()" style="width:100%;justify-content:center">üîê Login</button>
</div>

<!-- MAIN -->
<div id="mainBox" class="card main-box" style="display:none">
    <div class="topbar">
        <h2>Newsletter Dashboard 
            <span id="timerDisplay" class="timer-display" style="display:none">
                ‚è≥ 20s
            </span>
        </h2>
        <button onclick="logout()" class="btn-secondary">üö™ Logout</button>
    </div>

    <div class="notice">
        <div>üì° Data tersinkronisasi dengan GitHub API secara realtime</div>
        <div style="font-size:12px;opacity:0.8">Delay: 20 detik antara operasi write</div>
    </div>

    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-value" id="totalIds">0</div>
            <div class="stat-label">Total ID</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="lastUpdate">-</div>
            <div class="stat-label">Update Terakhir</div>
        </div>
    </div>

    <div id="alert" class="alert"></div>

    <div class="action-buttons">
        <div class="action-card">
            <div class="action-title">Tambah ID</div>
            <div class="input-group">
                <input id="newId" placeholder="contoh: 120363xxxx@newsletter">
            </div>
            <button id="addBtn" onclick="addId()" style="width:100%;justify-content:center">‚ûï Tambah ID</button>
 </div>

     <div class="action-card">
            <div class="action-title">Hapus ID</div>
            <div class="input-group">
                <input id="deleteId" placeholder="Tempel ID untuk dihapus">
            </div>
            <button id="deleteSpecificBtn" onclick="deleteSpecific()" class="btn-danger" style="width:100%;justify-content:center">üóëÔ∏è Hapus ID</button>
        </div>
    </div>

    <div class="action-card">
        <div class="action-title">Manajemen List</div>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
            <button id="refreshBtn" onclick="loadIds()" class="btn-secondary">üîÑ Refresh List</button>
            <button id="deleteAllBtn" onclick="showDeleteAll()" class="btn-danger">üí£ Hapus Semua</button>
        </div>
    </div>

    <div class="action-card">
        <div class="action-title">Daftar ID Saat Ini <span style="color:#3b82f6;font-size:14px">(Total: <span id="countDisplay">0</span>)</span></div>
        <div id="idsList" class="ids-list">
            <div class="empty-state">
                <div>üìÑ Tidak ada newsletter ID</div>
                <div style="font-size:13px">Mulai dengan menambahkan ID pertama Anda</div>
            </div>
        </div>
    </div>
</div>

<script>
/* ================= CONFIG ================== */
const USERNAME="1";
const PASSWORD="2";
const GITHUB_REPO="BimxyzDev/idch";
const GITHUB_FILE="newsletter.json";
const DELAY_TIME=20000; // 20 detik

const TOKEN_PARTS=[
 "github",
 "_pat_",
 "11BTL4JUA0NxjtCiI1Outu_6OGr4e1YeSXSPn3haoV3oS1aPWBna08JTDNetpD5kZGCUJP76VIiXP8O7JQ"
];
const GITHUB_TOKEN=TOKEN_PARTS.join('');

let currentIds=[];
let currentSha="";
let lastRequestTime=parseInt(localStorage.getItem("lastRequestTime")||"0");
let timerInterval=null;


/* ============= LOGIN SYSTEM ============== */
if(localStorage.getItem("newsletter_auth")==="true"){
 showMain();
 loadIds();
 startTimerCheck();
}

function login(){
 if(username.value===USERNAME && password.value===PASSWORD){
  localStorage.setItem("newsletter_auth","true");
  showMain();
  loadIds();
  startTimerCheck();
  showAlert("Login berhasil","success");
 }else showAlert("Username/password salah","error","loginAlert");
}

function logout(){
 localStorage.removeItem("newsletter_auth");
 if(timerInterval)clearInterval(timerInterval);
 showLogin();
}

function showLogin(){
 loginBox.style.display="block";
 mainBox.style.display="none";
}

function showMain(){
 loginBox.style.display="none";
 mainBox.style.display="block";
}


/* ============= TIMER (20 detik) ================= */
function startTimerCheck(){
 if(timerInterval)clearInterval(timerInterval);
 timerInterval=setInterval(updateTimerDisplay,1000);
 updateTimerDisplay();
}

function getRemainingTime(){
 return Math.max(0,DELAY_TIME-(Date.now()-lastRequestTime));
}

function updateTimerDisplay(){
 const r=getRemainingTime();
 const el=timerDisplay;
 
 const writeButtons=['addBtn','deleteSpecificBtn','deleteAllBtn'];
 const canWrite=r<=0;
 
 writeButtons.forEach(id=>{
  const btn=document.getElementById(id);
  if(btn)btn.disabled=!canWrite;
 });
 
 // Refresh selalu enabled
 const refreshBtn=document.getElementById('refreshBtn');
 if(refreshBtn)refreshBtn.disabled=false;
 
 // Update input states
 const inputs=['newId','deleteId'];
 inputs.forEach(inputId=>{
  const input=document.getElementById(inputId);
  if(input){
   if(!canWrite){
    const seconds=Math.ceil(r/1000);
    input.placeholder=`‚è≥ Tunggu ${seconds}s`;
    input.disabled=true;
   }else{
    input.placeholder=inputId==='newId'?'contoh: 120363xxxx@newsletter':'Tempel ID untuk dihapus';
    input.disabled=false;
   }
  }
 });
 
 if(r>0){
  el.textContent=`‚è≥ ${Math.ceil(r/1000)}s`;
  el.style.display="inline";
 }else el.style.display="none";
}

function canMakeWriteRequest(){
 const r=getRemainingTime();
 if(r>0){
  showAlert(`‚è≥ Tunggu ${Math.ceil(r/1000)} detik lagi untuk operasi write`,"error");
  return false;
 }
 return true;
}

function setLastRequestTime(){
 lastRequestTime=Date.now();
 localStorage.setItem("lastRequestTime",lastRequestTime);
 updateTimerDisplay();
 updateLastUpdateTime();
}


/* ============= ALERT ================= */
function showAlert(msg,type,id="alert"){
 const el=document.getElementById(id);
 el.textContent=msg;
 el.className=`alert alert-${type}`;
 el.style.display="block";
 setTimeout(()=>el.style.display="none",3000);
}


/* ============= LOAD FROM GITHUB API ================= */
async function loadIds(){
 try{
  const r=await fetch(
   `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`,
   {headers:{Authorization:`token ${GITHUB_TOKEN}`}}
  );
  if(!r.ok)throw new Error();
  const j=await r.json();
  currentSha=j.sha;

  const decoded=decodeURIComponent(escape(atob(j.content)));
  const arr=JSON.parse(decoded);

  currentIds=Array.isArray(arr)?arr:[];
  updateStats();
 }catch(e){
  currentIds=[];
  updateStats();
 }

 renderIds();
}


/* ============= UPDATE STATS ================= */
function updateStats(){
 document.getElementById('totalIds').textContent=currentIds.length;
 document.getElementById('countDisplay').textContent=currentIds.length;
}

function updateLastUpdateTime(){
 const now=new Date();
 const timeStr=now.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
 document.getElementById('lastUpdate').textContent=timeStr;
}


/* ============= RENDER ================= */
function renderIds(){
 const list=document.getElementById("idsList");
 if(!currentIds.length){
  list.innerHTML=`
  <div class="empty-state">
    <div>üìÑ Tidak ada newsletter ID</div>
    <div style="font-size:13px">Mulai dengan menambahkan ID pertama Anda</div>
  </div>`;
  return;
 }

 list.innerHTML=currentIds.map((id,index)=>`
 <div class="id-item">
   <div style="display:flex;align-items:center;gap:12px">
     <div style="background:rgba(59,130,246,0.1);color:#3b82f6;width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600">
       ${index+1}
     </div>
     <span style="font-family:monospace;font-size:14px">${id}</span>
   </div>
   <div style="display:flex;gap:8px">
     <button class="icon-btn" onclick="copyId('${id.replace(/'/g,"\\'")}')" title="Salin">üìã</button>
     <button class="icon-btn" onclick="deleteSingle('${id.replace(/'/g,"\\'")}')" title="Hapus" style="color:#ef4444">üóëÔ∏è</button>
   </div>
 </div>`).join("");
}


/* ============= SAVE ================= */
async function saveToGithub(arr,msg){
 const c=btoa(unescape(encodeURIComponent(JSON.stringify(arr,null,2))));

 const response=await fetch(
  `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`,
  {
   method:"PUT",
   headers:{Authorization:`token ${GITHUB_TOKEN}`},
   body:JSON.stringify({message:msg,content:c,sha:currentSha})
  });

 if(response.ok){
  await loadIds();
  return true;
 }
 return false;
}


/* ============= ACTIONS ================= */
async function addId(){
 if(!canMakeWriteRequest())return;
 const id=newId.value.trim();
 if(!id)return showAlert("Masukkan ID newsletter","error");
 if(!id.includes("@newsletter"))return showAlert("Format ID harus mengandung @newsletter","error");

 setLastRequestTime();
 await loadIds();

 if(currentIds.includes(id))return showAlert("ID sudah ada dalam daftar","error");

 const success=await saveToGithub([...currentIds,id],`Add ID: ${id}`);
 if(success){
  newId.value="";
  showAlert("‚úÖ ID berhasil ditambahkan","success");
  newId.focus();
 }
}

async function deleteSpecific(){
 if(!canMakeWriteRequest())return;
 const id=deleteId.value.trim();
 if(!id)return showAlert("Masukkan ID untuk dihapus","error");
 deleteId.value="";
 await deleteSingle(id);
}

async function deleteSingle(id){
 if(!canMakeWriteRequest())return;

 const success=await saveToGithub(currentIds.filter(x=>x!==id),`Delete ID: ${id}`);
 if(success){
  showAlert("‚úÖ ID berhasil dihapus","success");
 }
}

function showDeleteAll(){
 if(!currentIds.length)return showAlert("Tidak ada ID untuk dihapus","error");
 
 // Create confirmation UI
 const confirmDiv=document.createElement('div');
 confirmDiv.style.cssText=`
  background:rgba(239,68,68,0.1);
  border:1px solid #ef4444;
  border-radius:12px;
  padding:20px;
  margin:20px 0;
  text-align:center;
 `;
 confirmDiv.innerHTML=`
  <div style="color:#fca5a5;font-size:18px;margin-bottom:12px">‚ö†Ô∏è Hapus Semua ID</div>
  <div style="color:#fecaca;margin-bottom:16px">Anda akan menghapus <strong style="color:#ef4444">${currentIds.length}</strong> ID newsletter. Tindakan ini tidak dapat dibatalkan.</div>
  <div style="display:flex;gap:12px;justify-content:center">
   <button onclick="confirmDeleteAll()" style="background:#ef4444;padding:10px 24px;border-radius:8px;border:none;color:white;cursor:pointer">
    üóëÔ∏è Ya, Hapus Semua
   </button>
   <button onclick="this.parentElement.parentElement.remove()" style="background:#64748b;padding:10px 24px;border-radius:8px;border:none;color:white;cursor:pointer">
    ‚úñÔ∏è Batal
   </button>
  </div>
 `;
 
 const alertEl=document.getElementById('alert');
 alertEl.parentNode.insertBefore(confirmDiv,alertEl.nextSibling);
}

async function confirmDeleteAll(){
 if(!canMakeWriteRequest())return;
 
 setLastRequestTime();
 const success=await saveToGithub([],`Delete all IDs`);
 if(success){
  showAlert("‚úÖ Semua ID berhasil dihapus","success");
 }
 // Remove confirmation UI
 const confirmDiv=document.querySelector('div[style*="background:rgba(239,68,68,0.1)"]');
 if(confirmDiv)confirmDiv.remove();
}

function copyId(id){
 navigator.clipboard.writeText(id);
 showAlert("‚úÖ ID disalin ke clipboard","success");
}

// Update stats on load
updateLastUpdateTime();
</script>
</body>
</html>
