<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Newsletter Manager</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body{font-family:Segoe UI,Arial;background:linear-gradient(135deg,#4f46e5,#7c3aed);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
.container{width:100%;max-width:850px}
.card{background:#fff;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.15);overflow:hidden}
.header{padding:28px;background:linear-gradient(135deg,#4f46e5,#7c3aed);color:#fff;text-align:center}
.header h1{margin-bottom:6px}
.content{padding:30px}
.input-field{width:100%;padding:12px 15px;border-radius:10px;border:2px solid #e5e7eb}
.btn{padding:12px 22px;border-radius:12px;border:none;cursor:pointer;font-weight:600}
.btn-primary{background:#4f46e5;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.alert{padding:12px 15px;border-radius:12px;margin-bottom:15px}
.alert-success{background:#dcfce7;color:#065f46}
.alert-error{background:#fee2e2;color:#7f1d1d}
.id-item{background:#f9fafb;border-radius:12px;padding:12px 15px;margin-bottom:8px;display:flex;justify-content:space-between}
</style>
</head>
<body>
<div class="container">
<div class="card" id="loginScreen">
<div class="header"><h1>Newsletter Manager</h1></div>
<div class="content">
<div class="input-group">
<label>Username</label>
<input id="username" class="input-field">
</div>
<div class="input-group">
<label>Password</label>
<input id="password" type="password" class="input-field">
</div>
<div id="loginAlert" class="alert" style="display:none"></div>
<button id="loginBtn" class="btn btn-primary" style="width:100%">Login</button>
</div>
</div>

<div class="card" id="appScreen" style="display:none">
<div class="header"><h1>Newsletter Dashboard</h1></div>
<div class="content">
<div id="alertContainer"></div>

<div class="input-group">
<input id="newId" class="input-field" placeholder="120xxx@newsletter">
<button id="addBtn" class="btn btn-primary">Add</button>
</div>

<div class="input-group">
<input id="deleteId" class="input-field" placeholder="Delete ID">
<button id="deleteSpecificBtn" class="btn btn-danger">Delete</button>
</div>

<button id="deleteAllBtn" class="btn btn-danger">Delete All</button>
<button id="refreshBtn" class="btn btn-primary">Refresh</button>

<h3 id="idsCount"></h3>
<div id="idsList"></div>

<button id="logoutBtn" class="btn">Logout</button>
</div>
</div>
</div>

<script>
const CONFIG={
 USERNAME:"1",
 PASSWORD:"2",
 GITHUB:{REPO:"BimxyzDev/idch",FILE:"newsletter.json",BRANCH:"main"},
 TOKEN_PARTS:["github","_pat_","11BTL4JUA0NxjtCiI1Outu_6OGr4e1YeSXSPn3haoV3oS1aPWBna08JTDNetpD5kZGCUJP76VIiXP8O7JQ"]
};
const GITHUB_TOKEN=CONFIG.TOKEN_PARTS.join("");
let currentIds=[];

function showAlert(msg,type="success"){
 const c=document.getElementById("alertContainer");
 c.innerHTML='<div class="alert alert-'+type+'">'+msg+'</div>';
}

function renderIds(){
 const idsList=document.getElementById("idsList");
 const idsCount=document.getElementById("idsCount");
 idsCount.textContent=currentIds.length+" IDs";
 idsList.innerHTML=currentIds.map((id,i)=>'<div class="id-item"><span>'+(i+1)+'. '+id+'</span><button onclick="deleteSingleId(\''+id+'\')" class="btn btn-danger">X</button></div>').join("");
}

async function fetchLatestIds(){
 const url='https://raw.githubusercontent.com/'+CONFIG.GITHUB.REPO+'/'+CONFIG.GITHUB.BRANCH+'/'+CONFIG.GITHUB.FILE+'?t='+Date.now();
 const r=await fetch(url);
 if(!r.ok)throw new Error("fetch failed");
 return await r.json();
}

async function getGithubFileInfo(){
 const url='https://api.github.com/repos/'+CONFIG.GITHUB.REPO+'/contents/'+CONFIG.GITHUB.FILE';
 const r=await fetch(url,{headers:{Authorization:'token '+GITHUB_TOKEN}});
 if(!r.ok)throw new Error("lookup failed");
 return await r.json();
}

async function saveIdsToGithub(list){
 const file=await getGithubFileInfo();
 const body={
  message:'update '+new Date().toISOString(),
  content:btoa(unescape(encodeURIComponent(JSON.stringify(list,null,2)))),
  sha:file.sha,
  branch:CONFIG.GITHUB.BRANCH
 };
 const r=await fetch('https://api.github.com/repos/'+CONFIG.GITHUB.REPO+'/contents/'+CONFIG.GITHUB.FILE,{
  method:"PUT",
  headers:{Authorization:'token '+GITHUB_TOKEN,'Content-Type':'application/json'},
  body:JSON.stringify(body)
 });
 if(!r.ok){const e=await r.json();throw new Error(e.message||'update failed');}
}

async function loadIds(){
 try{
  currentIds=await fetchLatestIds();
 }catch(e){currentIds=[];}
 renderIds();
}

async function handleAddId(){
 const id=document.getElementById("newId").value.trim();
 if(!id.includes("@newsletter"))return showAlert("invalid","error");
 try{
  const latest=await fetchLatestIds();
  if(latest.includes(id))return showAlert("exists","error");
  latest.push(id);
  await saveIdsToGithub(latest);
  currentIds=latest;
  renderIds();
  showAlert("added");
 }catch(e){showAlert(e.message,"error");}
}

async function deleteSingleId(id){
 try{
  const latest=await fetchLatestIds();
  const filtered=latest.filter(x=>x!==id);
  await saveIdsToGithub(filtered);
  currentIds=filtered;
  renderIds();
  showAlert("deleted");
 }catch(e){showAlert(e.message,"error");}
}

async function handleDeleteSpecific(){
 deleteSingleId(document.getElementById("deleteId").value.trim());
}

async function handleDeleteAll(){
 if(!confirm("Delete all?"))return;
 await saveIdsToGithub([]);
 currentIds=[];
 renderIds();
}

function handleLogin(){
 const u=document.getElementById("username").value;
 const p=document.getElementById("password").value;
 if(u===CONFIG.USERNAME&&p===CONFIG.PASSWORD){
  localStorage.setItem("newsletter_auth","true");
  document.getElementById("loginScreen").style.display="none";
  document.getElementById("appScreen").style.display="block";
  loadIds();
 }else{
  const a=document.getElementById("loginAlert");
  a.style.display="block";
  a.textContent="Invalid login";
 }
}

document.getElementById("loginBtn").onclick=handleLogin;
document.getElementById("logoutBtn").onclick=()=>{localStorage.removeItem("newsletter_auth");location.reload()};
document.getElementById("addBtn").onclick=handleAddId;
document.getElementById("deleteSpecificBtn").onclick=handleDeleteSpecific;
document.getElementById("deleteAllBtn").onclick=handleDeleteAll;
document.getElementById("refreshBtn").onclick=loadIds;

if(localStorage.getItem("newsletter_auth")==="true"){
 document.getElementById("loginScreen").style.display="none";
 document.getElementById("appScreen").style.display="block";
 loadIds();
}
</script>
</body>
</html>